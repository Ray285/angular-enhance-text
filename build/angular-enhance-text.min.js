!function(a){"use strict";function b(a){var b=document.createElement("div");return b.appendChild(document.createTextNode(a)),b.innerHTML}function c(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function d(b,c){var d="";return a.isDefined(b)&&(d+='height="'+b+'" '),a.isDefined(c)&&(d+='width="'+c+'" '),d}var e=a.module("bernhardposselt.enhancetext",["ngSanitize"]).provider("enhanceTextFilter",function(){var b={cache:!0,newLineToBr:!0,embedLinks:!0,embeddedLinkTarget:"_blank",embedImages:!0,embeddedImagesHeight:void 0,embeddedImagesWidth:void 0,embedVideos:!0,embeddedVideosHeight:void 0,embeddedVideosWidth:void 0,embedYoutube:!0,embeddedYoutubeHeight:void 0,embeddedYoutubeWidth:void 0,embedSoundcloud:!0,embeddedSoundcloudHeight:void 0,embeddedSoundcloudWidth:void 0,smilies:{}},c={};this.setOptions=function(c){a.extend(b,c)},this.$get=["$sce","TextEnhancer",function(d,e){return function(f){var g=f;if(b.cache){var h=c[f];if(a.isDefined(h))return h}return f=e(f,b),f=d.trustAsHtml(f),b.cache&&(c[g]=f),f}}],this.$get.$inject=["$sce","TextEnhancer"]});e.factory("TextEnhancer",["SmileyEnhancer","VideoEnhancer","NewLineEnhancer","ImageEnhancer","YouTubeEnhancer","LinkEnhancer","SoundCloudEnhancer",function(a,c,d,e,f,g,h){return function(i,j){return i=b(i),i=a(i,j.smilies),j.embedImages&&(i=e(i,j.embeddedImagesHeight,j.embeddedVideosWidth,j.embeddedLinkTarget)),j.embedVideos&&(i=c(i,j.embeddedImagesHeight,j.embeddedVideosWidth)),j.embedYoutube&&(i=f(i,j.embeddedYoutubeHeight,j.embeddedYoutubeWidth)),j.embedSoundcloud&&(i=h(i,j.embeddedSoundcloudHeight,j.embeddedSoundcloudWidth)),j.newLineToBr&&(i=d(i)),j.embedLinks&&(i=g(i,j.embeddedLinkTarget)),i}}]),e.directive("bindHtmlPlus",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.bindHtmlPlus)},function(d){c.html(d),a(c.contents())(b)})}}]),e.factory("ImageEnhancer",function(){return function(a,b,c,e){void 0===e&&(e="_blank");var f=/((?:https?):\/\/\S*\.(?:gif|jpg|jpeg|tiff|png|svg|webp))/gi,g=d(b,c),h='<a href="$1" target="'+e+'"><img '+g+'alt="image" src="$1"/></a>';return a.replace(f,h)}}),e.factory("LinkEnhancer",function(){return function(a,b){void 0===b&&(b="_blank");var c=/((href|src)=["']|)(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return a.replace(c,function(){return arguments[1]?arguments[0]:'<a target="'+b+'" href="'+arguments[3]+'">'+arguments[3]+"</a>"})}}),e.factory("NewLineEnhancer",function(){return function(a){return a.replace(/\n/g,"<br/>").replace(/&#10;/g,"<br/>")}}),e.factory("SmileyEnhancer",function(){return function(a,b){for(var d=Object.keys(b),e=a.split("\n"),f=function(a,b,d){var e="^"+c(a)+" ",f=" "+c(a)+"$",g=" "+c(a)+" ",h="^"+c(a)+"$";return d.replace(new RegExp(e),b+" ").replace(new RegExp(f)," "+b).replace(new RegExp(g)," "+b+" ").replace(new RegExp(h),b)},g=0;g<d.length;g++){var h=d[g],i='<img alt="'+h+'" src="'+b[h]+'"/>',j=f.bind(null,h,i);e=e.map(j)}return e.join("\n")}}),e.factory("SoundCloudEnhancer",function(){return function(a,b,c){var e=/https?:\/\/(?:[0-9A-Z-]+\.)?soundcloud.com\/([a-zA-Z0-9-\/]+)*/gi,f=d(b,c),g="<soundcloud-enhancer "+f+"track=\"'$1'\"></soundcloud-enhancer>";return a.replace(e,g)}}),e.service("GetSoundcloud",["$http",function(a){this.get=function(b){return a({method:"GET",url:"http://soundcloud.com/oembed?url=http://soundcloud.com/"+b,withCredentials:!1})}}]),e.directive("soundcloudEnhancer",["GetSoundcloud",function(a){return{restrict:"E",scope:{track:"=?"},link:function(b,c,d){var e=b.track,f=function(a){c[0].innerHTML=a;var b=c[0].getElementsByTagName("iframe")[0],e=d.width?d.width:"100%",f=d.height?d.height:400;b.setAttribute("width",e),b.setAttribute("height",f)};a.get(e).success(function(a){f(a.html)})}}}]),e.factory("VideoEnhancer",function(){return function(a,b,c){var e=/((?:https?):\/\/\S*\.(?:ogv|webm))/gi,f=d(b,c),g="<video "+f+'src="$1" controls preload="none"></video>';return a.replace(e,g)}}),e.factory("YouTubeEnhancer",function(){return function(a,b,c){var e=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[?=&+%\w-]*/gi,f=d(b,c),g="<iframe "+f+'src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>';return a.replace(e,g)}})}(angular,void 0);